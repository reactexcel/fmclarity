<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/AutoForm/imports/AutoForm.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/AutoForm/imports/AutoForm.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author 			Leo Keith &lt;leo@fmclarity.com>
 * @copyright 		2016 FM Clarity Pty Ltd.
 */

import React from "react";
import { Text } from '/modules/ui/MaterialInputs';
import FormController from './FormController.jsx';

import injectTapEventPlugin from 'react-tap-event-plugin';
injectTapEventPlugin();

/**
 * @memberOf 		module:core/AutoForm
 * @extends 		React.Component
 */
class AutoForm extends React.Component {

	constructor( props ) {
		super( props );
		let { model, form, item } = props;

		this.form = new FormController( model, form, item );

		this.form.addCallback( ( newState ) => {
			this.setState( newState );
		} );

		this.state = {
			item: this.form.item,
			errors: this.form.errors
		}
	}

	checkCondition( condition, item ) {
		return (
			( _.isString( condition ) &amp;&amp; item.type == condition ) ||
			( _.isArray( condition ) &amp;&amp; _.contains( condition, item.type ) ) ||
			( _.isFunction( condition ) &amp;&amp; condition( item ) )
		)
	}

	getForm() {
		let { item, errors } = this.state;
		let form = this.form;
		let { keys, schema } = form;

		return keys.map( ( key ) => {

			//console.log( { schema, key } );

			if ( !schema[ key ] ) {
				throw new Meteor.Error( `No schema definition for field: ${key}` )
			}

			// Check visibility condition specified in schema
			if ( schema[ key ].condition != null ) {
				if ( !this.checkCondition( schema[ key ].condition, item ) ) {
					return;
				}
			}

			// Create default value for this field
			//  I feel like this should be done when initialising the form
			//  also 
			if ( item[ key ] == null ) {
				item[ key ] = this.form.getDefaultValue( key, item );
			}

			// Unpack options for this field (if the field is a generator)
			if ( _.isFunction( schema[ key ].options ) ) {
				schema[ key ].options = schema[ key ].options( item );
			}

			let { input, size = 12, label, description, options } = schema[ key ],
				placeholder = label,
				Input = null;


			// If this field in the schema has it's own subschema then recursively run autoform
			if ( schema[ key ].subschema != null ) {
				let { subschema, size, ...others } = schema[ key ];
				return (

					&lt;div key = { key } className = { `col-sm-${size}` }>

						&lt;AutoForm 
							item		= { item[ key ] }
							errors 		= { errors[ key ] }
							hideSubmit 	= { true }
							form		= { subschema } 
										  { ...others } 
						/>

					&lt;/div>

				)
			}
			// otherwise determine the type of input to create and make it,
			//  passing on the fields options as params
			else {

				if ( _.isObject( input ) ) {
					Input = input;
				}

				if ( Input == null ) {
					console.log( { key, fields: schema[ key ] } );
					throw new Error( `Invalid schema input type for field: ${key}`, `Trying to render a input type "${schema[ key ].input}" that does not exist` );
				}

				return (

					&lt;div key = { key } className = { `col-sm-${size}` }>

						&lt;Input 
							fieldName 	= { key }
							value 		= { item[ key ] } 
							onChange	= { ( update, modifiers ) => { form.updateField( key, update, modifiers ) } }
							errors 		= { errors[ key ] }
							placeholder	= { placeholder } 
							description	= { description }
										  { ...options } 
						/>

					&lt;/div>

				)
			}
		} );
	}

	render() {

		return (
			&lt;div className="autoform row">

				{ this.getForm() }

		        { ! this.props.hideSubmit ?

				&lt;div style={ {textAlign:"right", clear:"both"}}>
					&lt;button 
						type="button" 
						className="btn btn-flat btn-primary" 
						onClick={ ( ) => { this.form.save( this.item ) } }>
						Submit
					&lt;/button>
				&lt;/div>

				: null }

			&lt;/div>
		)

	}
}

export default AutoForm;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-core.html">core</a></li><li><a href="module-core_Actions.html">core/Actions</a></li><li><a href="module-core_Authentication.html">core/Authentication</a></li><li><a href="module-core_AutoForm.html">core/AutoForm</a></li><li><a href="module-core_Layouts.html">core/Layouts</a></li><li><a href="module-core_ORM.html">core/ORM</a></li><li><a href="module-features.html">features</a></li><li><a href="module-features_Admin.html">features/Admin</a></li><li><a href="module-features_Compliance.html">features/Compliance</a></li><li><a href="module-features_Reports.html">features/Reports</a></li><li><a href="module-mixins.html">mixins</a></li><li><a href="module-mixins_Areas.html">mixins/Areas</a></li><li><a href="module-mixins_Members.html">mixins/Members</a></li><li><a href="module-mixins_Owners.html">mixins/Owners</a></li><li><a href="module-mixins_Roles.html">mixins/Roles</a></li><li><a href="module-mixins_Services.html">mixins/Services</a></li><li><a href="module-mixins_Thumbs.html">mixins/Thumbs</a></li><li><a href="module-models.html">models</a></li><li><a href="module-models_Documents.html">models/Documents</a></li><li><a href="module-models_Facilities.html">models/Facilities</a></li><li><a href="module-models_Files.html">models/Files</a></li><li><a href="module-models_Messages.html">models/Messages</a></li><li><a href="module-models_Notifications.html">models/Notifications</a></li><li><a href="module-models_Requests.html">models/Requests</a></li><li><a href="module-models_Teams.html">models/Teams</a></li><li><a href="module-models_Users.html">models/Users</a></li><li><a href="module-ui.html">ui</a></li><li><a href="module-ui_Calendar.html">ui/Calendar</a></li><li><a href="module-ui_DataTable.html">ui/DataTable</a></li><li><a href="module-ui_MaterialInputs.html">ui/MaterialInputs</a></li><li><a href="module-ui_MaterialMisc.html">ui/MaterialMisc</a></li><li><a href="module-ui_MaterialNavigation.html">ui/MaterialNavigation</a></li><li><a href="module-ui_MaterialViews.html">ui/MaterialViews</a></li><li><a href="module-ui_Modal.html">ui/Modal</a></li><li><a href="module-ui_Stepper.html">ui/Stepper</a></li><li><a href="module-ui_Tabs.html">ui/Tabs</a></li></ul><h3>Classes</h3><ul><li><a href="module-core_Actions.Action.html">Action</a></li><li><a href="module-core_Actions.ActionGroup.html">ActionGroup</a></li><li><a href="module-core_Actions.Route.html">Route</a></li><li><a href="module-core_Actions.RouteGroup.html">RouteGroup</a></li><li><a href="module-core_AutoForm.AutoForm.html">AutoForm</a></li><li><a href="module-core_AutoForm.FormController.html">FormController</a></li><li><a href="module-core_Layouts.BlankLayout.html">BlankLayout</a></li><li><a href="module-core_Layouts.FloatingActionButtonContainer.html">FloatingActionButtonContainer</a></li><li><a href="module-core_Layouts.MainLayout.html">MainLayout</a></li><li><a href="module-core_Layouts.NavigationDrawerContainer.html">NavigationDrawerContainer</a></li><li><a href="module-core_Layouts.PrintLayout.html">PrintLayout</a></li><li><a href="module-core_Layouts.TopNavigationBarContainer.html">TopNavigationBarContainer</a></li><li><a href="module-core_Layouts.WideLayout.html">WideLayout</a></li><li><a href="module-core_ORM.Model.html">Model</a></li><li><a href="module-core_ORM.ValidatedMethod.html">ValidatedMethod</a></li><li><a href="module-models_Facilities.FacilityPanel.html">FacilityPanel</a></li><li><a href="module-models_Users.UserPageProfileContainer.html">UserPageProfileContainer</a></li><li><a href="module-ui_MaterialInputs.DateInput.html">DateInput</a></li><li><a href="module-ui_MaterialInputs.DateTime.html">DateTime</a></li><li><a href="module-ui_MaterialInputs.FileField.html">FileField</a></li><li><a href="module-ui_MaterialInputs.PlainCard.html">PlainCard</a></li><li><a href="module-ui_MaterialInputs.Rating.html">Rating</a></li><li><a href="module-ui_MaterialInputs.Select.html">Select</a></li><li><a href="module-ui_MaterialInputs.Switch.html">Switch</a></li><li><a href="module-ui_MaterialInputs.Text.html">Text</a></li><li><a href="module-ui_MaterialInputs.TextArea.html">TextArea</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Elastic">Elastic</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Sep 21 2016 21:54:02 GMT+1000 (E. Australia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
