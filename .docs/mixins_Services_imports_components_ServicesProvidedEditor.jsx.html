<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: mixins/Services/imports/components/ServicesProvidedEditor.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: mixins/Services/imports/components/ServicesProvidedEditor.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author          Leo Keith &lt;leo@fmclarity.com>
 * @copyright       2016 FM Clarity Pty Ltd.
 */
import React from "react";
import ServicesProvidedEditorRow from './ServicesProvidedEditorRow.jsx';

/**
 * @class 			ServicesProvidedEditor
 * @memberOf 		module:mixins/Services
 */
class ServicesProvidedEditor extends React.Component {

	constructor( props ) {
		super( props );
		let { item, field = "services" } = props;
		this.state = {
			item,
			field,
			services: item &amp;&amp; field ? item[ field ] : [],
			expanded: {}
		}
	}

	componentWillReceiveProps( props ) {
		//only update if the item (facility) being displayed has changed
		//this means the item will fail to refresh if updated by another client
		//a deep comparison could prevent this (if it is deemed worthwhile)
		if ( props.item._id != this.state.item._id ) {
			var item, field, services;
			item = props.item;
			field = props.field || "services";
			services = item &amp;&amp; field ? item[ field ] : [];
			this.setState( {
				item: item,
				field: field,
				services: services || [],
				expanded: {}
			} );
		}
	}

	componentDidMount() {
		this.save = _.debounce( this.save, 1000 );
	}

	save() {
		var item = this.state.item;
		var services = this.state.services;
		item.setServicesProvided( services );
		/* or???
		if(this.props.onChange) {
			this.props.onChange(this.state.services);
		}
		*/
	}

	updateService( idx, newValue ) {
		var services = this.state.services;
		if ( !newValue ) {
			services.splice( idx, 1 );
		} else {
			services[ idx ] = newValue;
		}
		this.setState( {
			services: services
		} )
		this.save();
	}

	updateSubService( idx, subIdx, newValue ) {
		var services = this.state.services;
		var service = services[ idx ];
		if ( !newValue ) {
			service.children.splice( subIdx, 1 );
		} else {
			service.children[ subIdx ] = newValue;
		}
		services[ idx ] = service;
		this.setState( {
			services: services
		} )
		this.save();
	}

	addService() {
		var services = this.state.services;
		var lastIndex = services.length - 1;
		var lastService = services[ lastIndex ];
		if ( !lastService || lastService.name.length ) {
			services.push( {
				name: ""
			} );
			this.setState( {
				services: services
			} )
			this.save();
		}
	}

	addSubService( idx ) {
		var services = this.state.services;
		var service = services[ idx ];
		service.children = service.children || [];
		var lastIndex = service.children.length - 1;
		var lastSubService = service.children[ lastIndex ];
		if ( !lastSubService || lastSubService.name.length ) {
			services[ idx ].children.push( {
				name: ""
			} );
			this.setState( {
				services: services
			} )
			this.save();
		}
	}

	toggleExpanded( supplierName ) {
		var expanded = this.state.expanded;
		expanded[ supplierName ] = expanded[ supplierName ] ? false : true;
		this.setState( {
			expanded: expanded
		} )
	}

	render() {
		var component = this;
		var services = this.state.services;
		var readOnly = false;
		return (
			&lt;div className="services-editor">
				&lt;div className="services-editor-row services-editor-row-header">
					&lt;div className="services-editor-col services-editor-col-header">Service&lt;/div>
					&lt;div className="services-editor-col services-editor-col-header">&lt;/div>
				&lt;/div>
				{services?services.map(function(service,idx){
					var expanded = component.state.expanded[service.name];
					var size = services.length;
					var key = size+'-'+idx;
					return (
						&lt;div key={key} className={expanded?"services-editor-service-expanded":""}>
							&lt;div className="services-editor-row">
								&lt;ServicesProvidedEditorRow
									service={service}
									readOnly={readOnly}
									clickExpand={component.toggleExpanded.bind(component,service.name)}
									onChange={component.updateService.bind(component,idx)}/>
							&lt;/div>

							&lt;div className="services-editor-child-block">
								{expanded?
									&lt;div>
										{service.children?service.children.map( (subservice,subIdx) => {
											var size=service.children.length;
											var key = size+'-'+subIdx;
											return (
												&lt;div key={key} className="services-editor-row services-editor-row-child">
													&lt;ServicesProvidedEditorRow
														service={subservice}
														readOnly={readOnly}
														onChange={component.updateSubService.bind(component,idx,subIdx)}/>
												&lt;/div>
											)
										}):null}
										{!readOnly?
									    	&lt;div onClick={component.addSubService.bind(component,idx)} className="services-editor-row services-editor-row-child" style={{fontSize:"smaller",fontStyle:"italic"}}>
												&lt;span style={{position:"absolute",left:"15px",top:"15px"}}>&lt;i className="fa fa-plus">&lt;/i>&lt;/span>
											    &lt;span style={{position:"absolute",left:"48px",top:"15px"}} className="active-link">Add subservice&lt;/span>
										    &lt;/div>
										:null}
									&lt;/div>
								:null}
							&lt;/div>
						&lt;/div>
					)
				}):null}
				{!readOnly?
				    &lt;div onClick={this.addService} className="services-editor-row" style={{fontStyle:"italic"}}>
						&lt;span style={{position:"absolute",left:"15px",top:"15px"}}>&lt;i className="fa fa-plus">&lt;/i>&lt;/span>
					    &lt;span style={{position:"absolute",left:"48px",top:"15px"}} className="active-link">Add service&lt;/span>
					&lt;/div>
				:null}
			&lt;/div>
		)
	}
}

export default ServicesProvidedEditor;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-core.html">core</a></li><li><a href="module-core_Actions.html">core/Actions</a></li><li><a href="module-core_Authentication.html">core/Authentication</a></li><li><a href="module-core_AutoForm.html">core/AutoForm</a></li><li><a href="module-core_Layouts.html">core/Layouts</a></li><li><a href="module-core_ORM.html">core/ORM</a></li><li><a href="module-features.html">features</a></li><li><a href="module-features_Admin.html">features/Admin</a></li><li><a href="module-features_Compliance.html">features/Compliance</a></li><li><a href="module-features_Reports.html">features/Reports</a></li><li><a href="module-mixins.html">mixins</a></li><li><a href="module-mixins_Areas.html">mixins/Areas</a></li><li><a href="module-mixins_Members.html">mixins/Members</a></li><li><a href="module-mixins_Owners.html">mixins/Owners</a></li><li><a href="module-mixins_Roles.html">mixins/Roles</a></li><li><a href="module-mixins_Services.html">mixins/Services</a></li><li><a href="module-mixins_Thumbs.html">mixins/Thumbs</a></li><li><a href="module-models.html">models</a></li><li><a href="module-models_Documents.html">models/Documents</a></li><li><a href="module-models_Facilities.html">models/Facilities</a></li><li><a href="module-models_Files.html">models/Files</a></li><li><a href="module-models_Messages.html">models/Messages</a></li><li><a href="module-models_Notifications.html">models/Notifications</a></li><li><a href="module-models_Requests.html">models/Requests</a></li><li><a href="module-models_Teams.html">models/Teams</a></li><li><a href="module-models_Users.html">models/Users</a></li><li><a href="module-ui.html">ui</a></li><li><a href="module-ui_Calendar.html">ui/Calendar</a></li><li><a href="module-ui_DataTable.html">ui/DataTable</a></li><li><a href="module-ui_MaterialInputs.html">ui/MaterialInputs</a></li><li><a href="module-ui_MaterialMisc.html">ui/MaterialMisc</a></li><li><a href="module-ui_MaterialNavigation.html">ui/MaterialNavigation</a></li><li><a href="module-ui_MaterialViews.html">ui/MaterialViews</a></li><li><a href="module-ui_Modal.html">ui/Modal</a></li><li><a href="module-ui_Stepper.html">ui/Stepper</a></li><li><a href="module-ui_Tabs.html">ui/Tabs</a></li></ul><h3>Classes</h3><ul><li><a href="module-core_Actions.Action.html">Action</a></li><li><a href="module-core_Actions.ActionGroup.html">ActionGroup</a></li><li><a href="module-core_Actions.Route.html">Route</a></li><li><a href="module-core_Actions.RouteGroup.html">RouteGroup</a></li><li><a href="module-core_Authentication.LoginService.html">LoginService</a></li><li><a href="module-core_Authentication.Page403.html">Page403</a></li><li><a href="module-core_Authentication.PageChangePassword.html">PageChangePassword</a></li><li><a href="module-core_Authentication.PageLogin.html">PageLogin</a></li><li><a href="module-core_Authentication.PageLostPassword.html">PageLostPassword</a></li><li><a href="module-core_Authentication.PageNotFound.html">PageNotFound</a></li><li><a href="module-core_Authentication.PageRegister.html">PageRegister</a></li><li><a href="module-core_AutoForm.AutoForm.html">AutoForm</a></li><li><a href="module-core_AutoForm.FormController.html">FormController</a></li><li><a href="module-core_Layouts.FloatingActionButtonContainer.html">FloatingActionButtonContainer</a></li><li><a href="module-core_Layouts.LayoutBlank.html">LayoutBlank</a></li><li><a href="module-core_Layouts.LayoutMain.html">LayoutMain</a></li><li><a href="module-core_Layouts.LayoutPrint.html">LayoutPrint</a></li><li><a href="module-core_Layouts.LayoutWide.html">LayoutWide</a></li><li><a href="module-core_Layouts.NavigationDrawerContainer.html">NavigationDrawerContainer</a></li><li><a href="module-core_Layouts.TopNavigationBarContainer.html">TopNavigationBarContainer</a></li><li><a href="module-core_ORM.Model.html">Model</a></li><li><a href="module-core_ORM.ValidatedMethod.html">ValidatedMethod</a></li><li><a href="module-features_Admin.AdminPageIndex.html">AdminPageIndex</a></li><li><a href="module-features_Compliance.CompliancePageIndex.html">CompliancePageIndex</a></li><li><a href="module-features_Compliance.CompliancePageIndexContainer.html">CompliancePageIndexContainer</a></li><li><a href="module-features_Reports.PageDashboard.html">PageDashboard</a></li><li><a href="module-features_Reports.PageDashboardContainer.html">PageDashboardContainer</a></li><li><a href="module-mixins_Areas.AreasEditor.html">AreasEditor</a></li><li><a href="module-mixins_Services.ServicesProvidedEditor.html">ServicesProvidedEditor</a></li><li><a href="module-mixins_Services.ServicesProvidedEditorRow.html">ServicesProvidedEditorRow</a></li><li><a href="module-mixins_Services.ServicesRequiredEditor.html">ServicesRequiredEditor</a></li><li><a href="module-mixins_Services.ServicesRequiredEditorRow.html">ServicesRequiredEditorRow</a></li><li><a href="module-models_Facilities.FacilityFilter.html">FacilityFilter</a></li><li><a href="module-models_Facilities.FacilityListTile.html">FacilityListTile</a></li><li><a href="module-models_Facilities.FacilityPanel.html">FacilityPanel</a></li><li><a href="module-models_Files.FileExplorer.html">FileExplorer</a></li><li><a href="module-models_Files.FilesPageIndex.html">FilesPageIndex</a></li><li><a href="module-models_Files.FileView.html">FileView</a></li><li><a href="module-models_Files.FileViewEdit.html">FileViewEdit</a></li><li><a href="module-models_Requests.RequestsPageIndex.html">RequestsPageIndex</a></li><li><a href="module-models_Teams.TeamPageSuppliers.html">TeamPageSuppliers</a></li><li><a href="module-models_Teams.TeamPageSuppliersContainer.html">TeamPageSuppliersContainer</a></li><li><a href="module-models_Teams.TeamPanel.html">TeamPanel</a></li><li><a href="module-models_Users.UserPageProfileContainer.html">UserPageProfileContainer</a></li><li><a href="module-models_Users.UsersPageIndex.html">UsersPageIndex</a></li><li><a href="module-ui_Calendar.CalendarPage.html">CalendarPage</a></li><li><a href="module-ui_MaterialInputs.DateInput.html">DateInput</a></li><li><a href="module-ui_MaterialInputs.DateTime.html">DateTime</a></li><li><a href="module-ui_MaterialInputs.FileField.html">FileField</a></li><li><a href="module-ui_MaterialInputs.PlainCard.html">PlainCard</a></li><li><a href="module-ui_MaterialInputs.Rating.html">Rating</a></li><li><a href="module-ui_MaterialInputs.Select.html">Select</a></li><li><a href="module-ui_MaterialInputs.Switch.html">Switch</a></li><li><a href="module-ui_MaterialInputs.Text.html">Text</a></li><li><a href="module-ui_MaterialInputs.TextArea.html">TextArea</a></li><li><a href="module-ui_MaterialNavigation.NavListDropDown.html">NavListDropDown</a></li><li><a href="module-ui_MaterialNavigation.NavListTileMultiple.html">NavListTileMultiple</a></li><li><a href="module-ui_MaterialViews.ListTile.html">ListTile</a></li><li><a href="module-ui_MaterialViews.Thumbnail.html">Thumbnail</a></li><li><a href="UserPanel.html">UserPanel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Elastic">Elastic</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Sep 22 2016 23:17:32 GMT+1000 (E. Australia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
